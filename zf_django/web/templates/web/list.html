{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µê³  ëª©ë¡ - ì§‘í• ZIPFIT</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/layout.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    
    <style>
        /* ëª¨ì§‘ ê¸°ê°„ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .recruitment-period {
            background: #ecfdf5;
            border: 1px solid #d1fae5;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .recruitment-period-icon {
            width: 20px;
            height: 20px;
            color: #009966;
            flex-shrink: 0;
        }
        
        .recruitment-period-text {
            flex: 1;
        }
        
        .recruitment-period-label {
            font-size: 12px;
            color: #007a55;
            font-weight: 500;
            display: block;
            margin-bottom: 4px;
        }
        
        .recruitment-period-date {
            font-size: 14px;
            color: #18181b;
            font-weight: 600;
        }
        
        .recruitment-period-days {
            font-size: 12px;
            color: #dc2626;
            font-weight: 600;
            margin-left: 8px;
        }
        
        /* ê³µê³  ìœ í˜• íƒœê·¸ */
        .type-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #f4f4f5;
            color: #52525c;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 6px;
        }
        
        /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .announcement-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }
        
        .btn-ai-consult {
            flex: 1;
            background: linear-gradient(90deg, #009966 0%, #00a63e 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            -webkit-tap-highlight-color: rgba(0, 153, 102, 0.2);
            touch-action: manipulation;
            position: relative;
            z-index: 1;
        }
        
        .btn-ai-consult:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 153, 102, 0.3);
        }
        
        .btn-ai-consult svg {
            width: 16px;
            height: 16px;
        }
        
        .btn-website {
            flex: 1;
            background: white;
            color: #18181b;
            border: 1.5px solid #e4e4e7;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            -webkit-tap-highlight-color: rgba(0, 153, 102, 0.2);
            touch-action: manipulation;
            position: relative;
            z-index: 1;
        }
        
        .btn-website:hover {
            background: #f4f4f5;
            border-color: #d4d4d8;
        }
        
        .btn-website svg {
            width: 16px;
            height: 16px;
        }
        
        /* ì±„íŒ… íˆìŠ¤í† ë¦¬ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ */
        .chat-history-item {
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .chat-history-item:hover {
            background: #f4f4f5;
        }

        .chat-history-content {
            flex: 1;
            min-width: 0;
        }

        .chat-history-content h5 {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-delete-btn {
            opacity: 0;
            transition: opacity 0.2s;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .chat-delete-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .chat-delete-btn svg {
            width: 16px;
            height: 16px;
            color: #ef4444;
        }

        .chat-history-item:hover .chat-delete-btn {
            opacity: 1;
        }

        /* ì´ˆê¸°í™” ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .btn-reset:hover {
            background: #dc2626 !important;
            color: white !important;
        }

        /* í•„í„° ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .filters-section {
            padding: 24px 32px;
            background: white;
            border-bottom: 1px solid #e4e4e7;
            margin-bottom: 24px;
        }

        .search-box {
            position: relative;
            margin-bottom: 16px;
        }

        .search-box svg {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            width: 20px;
            height: 20px;
            color: #52525c;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 1px solid #e4e4e7;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            background: white !important;
            color: #18181b !important;
        }

        .search-box input:focus {
            outline: none;
            border-color: #009966;
            box-shadow: 0 0 0 3px rgba(0, 153, 102, 0.1);
        }

        .search-box input::placeholder {
            color: #9f9fa9 !important;
        }

        .filter-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 14px;
            padding-right: 36px;
            border: 1px solid #e4e4e7;
            border-radius: 10px;
            font-size: 14px;
            background: white !important;
            color: #18181b !important;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 140px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%2352525C' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .filter-select:focus {
            outline: none;
            border-color: #009966;
            box-shadow: 0 0 0 3px rgba(0, 153, 102, 0.1);
        }

        .filter-select:hover {
            border-color: #009966;
        }
        
        .filter-select option {
            background: white;
            color: #18181b;
            padding: 8px;
        }
        
        .filter-select:not([value=""]) {
            border-color: #009966;
            background-color: #f0fdf4;
        }

        .announcement-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            padding: 0 32px 32px;
            min-height: 400px;
            align-items: center;
            justify-content: center;
        }
        
        .announcement-grid:empty::before {
            content: '';
        }
        
        @media (max-width: 768px) {
            .announcement-grid {
                grid-template-columns: 1fr;
                padding: 0 16px 16px;
                gap: 16px;
                min-height: 300px;
            }
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
        .pagination-container {
            padding: 24px 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #e4e4e7;
            border-radius: 8px;
            background: white;
            color: #52525c;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f4f4f5;
            border-color: #d4d4d8;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #009966;
            color: white;
            border-color: #009966;
        }
        
        /* ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ê°œì„  */
        @media (max-width: 768px) {
            .user-edit-modal {
                max-width: 90%;
                padding: 24px;
                max-height: 90vh;
            }
            
            .announcement-card {
                padding: 16px;
            }
            
            .announcement-card h3 {
                font-size: 16px;
                line-height: 1.4;
                margin-bottom: 12px;
            }
            
            .announcement-header {
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 12px;
            }
            
            .announcement-header > div {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .agency-badge,
            .type-badge {
                font-size: 11px;
                padding: 3px 8px;
                white-space: nowrap;
            }
            
            .status-badge {
                font-size: 11px;
                padding: 3px 8px;
            }
            
            .recruitment-period {
                padding: 10px;
                margin-top: 10px;
            }
            
            .recruitment-period-label {
                font-size: 11px;
            }
            
            .recruitment-period-date {
                font-size: 13px;
            }
            
            .recruitment-period-days {
                font-size: 11px;
            }
            
            .announcement-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn-ai-consult,
            .btn-website {
                width: 100%;
            }
            
            .filter-group {
                flex-direction: column;
            }
            
            .filter-select {
                width: 100%;
                min-width: auto;
            }
        }
        
        @media (max-width: 375px) {
            .announcement-card h3 {
                font-size: 14px;
            }
            
            .agency-badge,
            .type-badge,
            .status-badge {
                font-size: 10px;
                padding: 2px 6px;
            }
        }
    </style>
</head>
<body>
    <!-- ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleSidebar(event)">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>
    
    <!-- ì‚¬ì´ë“œë°” ì˜¤ë²„ë ˆì´ (ëª¨ë°”ì¼) -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <div class="app-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <!-- ì‚¬ì´ë“œë°” í—¤ë” -->
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-icon">
                        <div class="logo-bg">
                            <svg class="logo-house" viewBox="0 0 20 22" fill="none">
                                <path d="M9.72 0.72L0.72 8.64V20.52H6.12V13.32H13.32V20.52H18.72V8.64L9.72 0.72Z" 
                                      fill="url(#logoGrad1)" 
                                      stroke="url(#logoGrad2)" 
                                      stroke-width="1.44" 
                                      stroke-linejoin="round"/>
                                <defs>
                                    <linearGradient id="logoGrad1" x1="0.72" y1="0.72" x2="18.72" y2="20.52" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#10B981"/>
                                        <stop offset="1" stop-color="#059669"/>
                                    </linearGradient>
                                    <linearGradient id="logoGrad2" x1="0.72" y1="0.72" x2="18.72" y2="20.52" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#10B981"/>
                                        <stop offset="1" stop-color="#059669"/>
                                    </linearGradient>
                                </defs>
                            </svg>
                        </div>
                    </div>
                    <div class="logo-text">
                        <h2>ì§‘í•</h2>
                        <p>ZIPFIT</p>
                    </div>
                </div>
            </div>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav class="sidebar-nav">
                <a href="{% url 'web:main' %}" class="nav-item">
                    <svg viewBox="0 0 20 20" fill="none">
                        <path d="M12.5 17.5V10.8333C12.5 10.6123 12.4122 10.4004 12.2559 10.2441C12.0996 10.0878 11.8877 10 11.6667 10H8.33333C8.11232 10 7.90036 10.0878 7.74408 10.2441C7.5878 10.4004 7.5 10.6123 7.5 10.8333V17.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2.5 8.33333C2.49994 8.09089 2.55278 7.85135 2.65482 7.63143C2.75687 7.41151 2.90566 7.2165 3.09083 7.06L8.92417 2.06C9.22499 1.80576 9.60613 1.66627 10 1.66627C10.3939 1.66627 10.775 1.80576 11.0758 2.06L16.9092 7.06C17.0943 7.2165 17.2431 7.41151 17.3452 7.63143C17.4472 7.85135 17.5001 8.09089 17.5 8.33333V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V8.33333Z" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>í™ˆ</span>
                </a>
                <a href="{% url 'web:chat' %}" class="nav-item" onclick="clearAnnouncementContext()">
                    <svg viewBox="0 0 20 20" fill="none">
                        <path d="M18.3333 14.1667C18.3333 14.6087 18.1577 15.0326 17.8452 15.3452C17.5326 15.6577 17.1087 15.8333 16.6667 15.8333H5.69C5.24801 15.8334 4.82415 16.0091 4.51167 16.3217L2.67667 18.1567C2.59392 18.2394 2.4885 18.2957 2.37374 18.3186C2.25898 18.3414 2.14003 18.3297 2.03192 18.2849C1.92382 18.2401 1.83142 18.1643 1.7664 18.067C1.70139 17.9697 1.66668 17.8553 1.66667 17.7383V4.16667C1.66667 3.72464 1.84226 3.30072 2.15482 2.98816C2.46738 2.67559 2.89131 2.5 3.33333 2.5H16.6667C17.1087 2.5 17.5326 2.67559 17.8452 2.98816C18.1577 3.30072 18.3333 3.72464 18.3333 4.16667V14.1667Z" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>AI ìƒë‹´</span>
                    <span class="badge">Main</span>
                </a>
                <a href="{% url 'web:list' %}" class="nav-item active">
                    <svg viewBox="0 0 20 20" fill="none">
                        <path d="M5 18.3333C4.55797 18.3333 4.13405 18.1577 3.82149 17.8452C3.50893 17.5326 3.33333 17.1087 3.33333 16.6667V3.33334C3.33333 2.89131 3.50893 2.46739 3.82149 2.15482C4.13405 1.84226 4.55797 1.66667 5 1.66667H11.6667C11.9305 1.66624 12.1917 1.718 12.4354 1.81898C12.6791 1.91995 12.9005 2.06814 13.0867 2.255L16.0767 5.245C16.264 5.43126 16.4126 5.65279 16.5139 5.8968C16.6152 6.14082 16.6671 6.40248 16.6667 6.66667V16.6667C16.6667 17.1087 16.4911 17.5326 16.1785 17.8452C15.866 18.1577 15.442 18.3333 15 18.3333H5Z" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M11.6667 1.66667V5.83333C11.6667 6.05435 11.7545 6.26631 11.9107 6.42259C12.067 6.57887 12.279 6.66667 12.5 6.66667H16.6667" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.33333 7.5H6.66667" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M13.3333 10.8333H6.66667" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M13.3333 14.1667H6.66667" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>ê³µê³  ëª©ë¡</span>
                </a>

                <!-- ì±„íŒ… íˆìŠ¤í† ë¦¬ -->
                <div class="chat-history mt-3" id="chatHistoryList">
                    <!-- Chat histories will be loaded here dynamically -->
                </div>
            </nav>

            <!-- ì‚¬ìš©ì ì •ë³´ (í´ë¦­ ì‹œ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™) -->
            <div class="user-info" onclick="window.location.href='{% url 'web:user_info_modify' %}'" style="cursor: pointer;" title="í´ë¦­í•˜ì—¬ ì •ë³´ ìˆ˜ì •">
                <div class="user-avatar" id="userAvatar">ë§¤</div>
                <div class="user-details">
                    <h5 id="userDisplayName">ì‚¬ìš©ì</h5>
                    <p id="userDisplayInfo">ì •ë³´ ì—†ìŒ</p>
                </div>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M4 6L8 10L12 6" stroke="#9F9FA9" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </aside>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- í—¤ë” -->
            <header class="main-header">
                <div class="header-title">
                    <h1>ê³µê³  ëª©ë¡</h1>
                    <p>ìµœì‹  ê³µê³µì£¼íƒ ê³µê³ ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                </div>
                <div class="header-actions">
                    <span class="badge-lh">LH</span>
                    <span class="badge-sh">SH</span>
                    <span class="badge-gh">GH</span>
                </div>
            </header>

            <!-- í•„í„° ì„¹ì…˜ -->
            <div class="filters-section">
                <div class="search-box">
                    <svg viewBox="0 0 20 20" fill="none">
                        <path d="M9.16667 15.8333C12.8486 15.8333 15.8333 12.8486 15.8333 9.16667C15.8333 5.48477 12.8486 2.5 9.16667 2.5C5.48477 2.5 2.5 5.48477 2.5 9.16667C2.5 12.8486 5.48477 15.8333 9.16667 15.8333Z" stroke="#52525C" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M17.5 17.5L13.875 13.875" stroke="#52525C" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <input type="text" placeholder="ê³µê³ ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”..." id="searchInput" onkeyup="debounceSearch()">
                </div>
                
                <div class="filter-group">
                    <select class="filter-select" id="agencyFilter" style="display: none;" onchange="filterAnnouncements()">
                        <option value="">ì „ì²´ ê¸°ê´€</option>
                        <option value="LH">LH í•œêµ­í† ì§€ì£¼íƒê³µì‚¬</option>
                        <option value="SH">SH ì„œìš¸ì£¼íƒë„ì‹œê³µì‚¬</option>
                        <option value="GH">GH ê²½ê¸°ì£¼íƒë„ì‹œê³µì‚¬</option>
                    </select>

                    <select class="filter-select" id="typeFilter" onchange="filterAnnouncements()">
                        <option value="">ì „ì²´ ìœ í˜•</option>
                        <option value="ë¶„ì–‘">ë¶„ì–‘</option>
                        <option value="ì„ëŒ€">ì„ëŒ€</option>
                    </select>

                    <select class="filter-select" id="regionFilter" onchange="filterAnnouncements()">
                        <option value="">ì „ì²´ ì§€ì—­</option>
                    </select>

                    <select class="filter-select" id="statusFilter" onchange="filterAnnouncements()">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="ê³µê³ ì¤‘">ê³µê³ ì¤‘</option>
                        <option value="ì ‘ìˆ˜ì¤‘">ì ‘ìˆ˜ì¤‘</option>
                        <option value="ë§ˆê°">ë§ˆê°</option>
                        <option value="ì •ì •ê³µê³ ì¤‘">ì •ì •ê³µê³ ì¤‘</option>
                        <option value="ê³µê³ ì˜ˆì •" style="display: none;">ê³µê³ ì˜ˆì •</option>
                    </select>
                </div>
            </div>

            <!-- ê³µê³  ê·¸ë¦¬ë“œ -->
            <div class="announcement-grid" id="announcementGrid">
                <!-- ê³µê³  ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div class="pagination-container" id="paginationContainer" style="display: none;">
                <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/api.js' %}"></script>
    <script src="{% static 'js/mockData.js' %}"></script>
    <script>
        // í˜„ì¬ í˜ì´ì§€ ì •ë³´
        let currentPage = 1;
        let totalPages = 1;
        let allAnnouncements = [];

        // ============================================
        // ê³µê³  ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜ (ì‚¬ì´ë“œë°” AI ìƒë‹´ í´ë¦­ ì‹œ í˜¸ì¶œ)
        function clearAnnouncementContext() {
            sessionStorage.removeItem('currentAnnouncementId');
            sessionStorage.removeItem('currentAnnouncementName');
            // ğŸ”¥ ì„¸ì…˜ë„ ì´ˆê¸°í™”í•˜ì—¬ ìƒˆë¡œìš´ ëŒ€í™” ì‹œì‘
            sessionStorage.removeItem('current_session_id');
        }

        // ğŸ”¥ AI ìƒë‹´í•˜ê¸° í´ë¦­ ì‹œ ê³µê³  ID + ì‚¬ìš©ì ì •ë³´ ì „ë‹¬
        // ============================================
        function goToAIConsult(announcementId, announcementName) {
            console.log('[AI ìƒë‹´] ê³µê³  ID:', announcementId, 'ê³µê³ ëª…:', announcementName);

            // ğŸ”¥ ì„¸ì…˜ ì´ˆê¸°í™” (ìƒˆë¡œìš´ ëŒ€í™”ë¥¼ ìœ„í•´)
            sessionStorage.removeItem('current_session_id');
            
            // ê³µê³  ì •ë³´ë¥¼ sessionStorageì— ì €ì¥
            sessionStorage.setItem('currentAnnouncementId', announcementId);
            sessionStorage.setItem('currentAnnouncementName', announcementName);
            
            // ì±„íŒ… í˜ì´ì§€ë¡œ ì´ë™ (ê³µê³  IDë¥¼ URL íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬)
            window.location.href = `{% url 'web:chat' %}?announcement_id=${encodeURIComponent(announcementId)}`;
        }
        
        // ============================================
        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        // ============================================

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function loadUserInfo() {
            try {
                const savedData = sessionStorage.getItem('userInfo') || localStorage.getItem('userInfo');
                const userKey = getOrCreateUserKey();

                // user_keyë¥¼ userIdë¡œ ì‚¬ìš©
                document.getElementById('userDisplayName').textContent = userKey;
                document.getElementById('userAvatar').textContent = userKey.charAt(0);

                if (savedData) {
                    const userInfo = JSON.parse(savedData);

                    let infoText = '';
                    if (userInfo.age) infoText += userInfo.age + 'ì„¸';
                    if (userInfo.location) {
                        if (infoText) infoText += ' Â· ';
                        infoText += userInfo.location;
                    }
                    if (infoText) {
                        document.getElementById('userDisplayInfo').textContent = infoText;
                    }
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ============================================
        // ê³µê³  ëª©ë¡ ê´€ë¦¬
        // ============================================

        // í•„í„° ì˜µì…˜ ë™ì  ìƒì„± í•¨ìˆ˜
        function populateFilterOptions(announcements) {
            const regionFilter = document.getElementById('regionFilter');
            const currentRegionValue = regionFilter ? regionFilter.value : '';
            
            const regions = new Set();
            announcements.forEach(annc => {
                if (annc.annc_region) {
                    regions.add(annc.annc_region);
                }
            });
            
            const sortedRegions = Array.from(regions).sort((a, b) => {
                if (a === 'ì „êµ­') return -1;
                if (b === 'ì „êµ­') return 1;
                return a.localeCompare(b, 'ko');
            });
            
            if (regionFilter) {
                regionFilter.innerHTML = '<option value="">ì „ì²´ ì§€ì—­</option>';
                sortedRegions.forEach(region => {
                    const option = document.createElement('option');
                    option.value = region;
                    option.textContent = region;
                    regionFilter.appendChild(option);
                });
                
                if (currentRegionValue) {
                    regionFilter.value = currentRegionValue;
                }
            }
        }
        
        // ëª¨ì§‘ ê¸°ê°„ ê³„ì‚° í•¨ìˆ˜
        function getRecruitmentPeriod(annc) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (annc.annc_pblsh_dt && annc.annc_deadline_dt) {
                const parseDate = (dateStr) => {
                    if (!dateStr) return null;
                    const cleaned = dateStr.replace(/[.\s]/g, '-');
                    const parts = cleaned.split('-');
                    if (parts.length === 3) {
                        const year = parseInt(parts[0], 10);
                        const month = parseInt(parts[1], 10) - 1;
                        const day = parseInt(parts[2], 10);
                        return new Date(year, month, day);
                    }
                    return null;
                };
                
                const startDate = parseDate(annc.annc_pblsh_dt);
                const endDate = parseDate(annc.annc_deadline_dt);
                
                if (startDate && endDate) {
                    const formatDate = (date) => {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}.${month}.${day}`;
                    };
                    return `${formatDate(startDate)} ~ ${formatDate(endDate)}`;
                }
            }
            
            if (annc.recruitment_start_date && annc.recruitment_end_date) {
                const formatDate = (dateStr) => {
                    const date = new Date(dateStr);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}.${month}.${day}`;
                };
                return `${formatDate(annc.recruitment_start_date)} ~ ${formatDate(annc.recruitment_end_date)}`;
            }
            
            const createdDate = annc.created_at ? new Date(annc.created_at) : today;
            const startDate = new Date(createdDate);
            
            if (annc.annc_status === 'ê³µê³ ì˜ˆì •') {
                startDate.setDate(today.getDate() + Math.max(1, 3 + (annc.annc_id % 7)));
            } else {
                startDate.setDate(createdDate.getDate() + 1);
                if (startDate < today) {
                    startDate.setTime(today.getTime());
                }
            }
            
            const endDate = new Date(startDate);
            if (annc.annc_status === 'ë§ˆê°') {
                endDate.setDate(startDate.getDate() - Math.max(1, annc.annc_id % 5));
            } else if (annc.annc_status === 'ê³µê³ ì˜ˆì •') {
                endDate.setDate(startDate.getDate() + 20 + (annc.annc_id % 10));
            } else {
                endDate.setDate(startDate.getDate() + 10 + (annc.annc_id % 10));
            }
            
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}.${month}.${day}`;
            };
            
            return `${formatDate(startDate)} ~ ${formatDate(endDate)}`;
        }
        
        // D-day ê³„ì‚° í•¨ìˆ˜
        function getDDay(annc) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const currentStatus = getCurrentStatus(annc);
            if (currentStatus === 'ê³µê³ ì˜ˆì •') {
                return '';
            }
            
            if (annc.annc_deadline_dt) {
                const parseDate = (dateStr) => {
                    if (!dateStr) return null;
                    const cleaned = dateStr.replace(/[.\s]/g, '-');
                    const parts = cleaned.split('-');
                    if (parts.length === 3) {
                        const year = parseInt(parts[0], 10);
                        const month = parseInt(parts[1], 10) - 1;
                        const day = parseInt(parts[2], 10);
                        if (isNaN(year) || isNaN(month) || isNaN(day)) return null;
                        const date = new Date(year, month, day);
                        if (date.getFullYear() !== year || date.getMonth() !== month || date.getDate() !== day) {
                            return null;
                        }
                        return date;
                    }
                    return null;
                };
                
                const endDate = parseDate(annc.annc_deadline_dt);
                if (endDate) {
                    endDate.setHours(0, 0, 0, 0);
                    const diffTime = endDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        return 'ë§ˆê°';
                    } else if (diffDays === 0) {
                        return 'D-Day';
                    } else {
                        return `D-${diffDays}`;
                    }
                }
            }
            
            if (annc.recruitment_end_date) {
                const endDate = new Date(annc.recruitment_end_date);
                endDate.setHours(0, 0, 0, 0);
                const diffTime = endDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays < 0) {
                    return 'ë§ˆê°';
                } else if (diffDays === 0) {
                    return 'D-Day';
                } else {
                    return `D-${diffDays}`;
                }
            }
            
            const createdDate = annc.created_at ? new Date(annc.created_at) : today;
            
            const startDate = new Date(createdDate);
            if (annc.annc_status === 'ê³µê³ ì˜ˆì •') {
                startDate.setDate(today.getDate() + Math.max(1, 3 + (annc.annc_id % 7)));
            } else {
                startDate.setDate(createdDate.getDate() + 1);
                if (startDate < today) {
                    startDate.setTime(today.getTime());
                }
            }
            
            const endDate = new Date(startDate);
            if (annc.annc_status === 'ë§ˆê°') {
                endDate.setDate(startDate.getDate() - Math.max(1, annc.annc_id % 5));
            } else if (annc.annc_status === 'ê³µê³ ì˜ˆì •') {
                endDate.setDate(startDate.getDate() + 20 + (annc.annc_id % 10));
            } else {
                endDate.setDate(startDate.getDate() + 10 + (annc.annc_id % 10));
            }
            endDate.setHours(0, 0, 0, 0);
            
            const diffTime = endDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) {
                return 'ë§ˆê°';
            } else if (startDate > today) {
                return '';
            } else if (diffDays === 0) {
                return 'D-Day';
            } else {
                return `D-${diffDays}`;
            }
        }
        
        // í˜„ì¬ ìƒíƒœ ê³„ì‚° í•¨ìˆ˜
        function getCurrentStatus(annc) {
            if (annc.annc_status) {
                if (annc.annc_status === 'ì ‘ìˆ˜ë§ˆê°') {
                    return 'ë§ˆê°';
                }
                return annc.annc_status;
            }
            
            if (annc.annc_pblsh_dt && annc.annc_deadline_dt) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const parseDate = (dateStr) => {
                    if (!dateStr) return null;
                    const cleaned = dateStr.replace(/[.\s]/g, '-');
                    const parts = cleaned.split('-');
                    if (parts.length === 3) {
                        const year = parseInt(parts[0], 10);
                        const month = parseInt(parts[1], 10) - 1;
                        const day = parseInt(parts[2], 10);
                        if (isNaN(year) || isNaN(month) || isNaN(day)) return null;
                        const date = new Date(year, month, day);
                        if (date.getFullYear() !== year || date.getMonth() !== month || date.getDate() !== day) {
                            return null;
                        }
                        return date;
                    }
                    return null;
                };
                
                const publishDate = parseDate(annc.annc_pblsh_dt);
                const deadlineDate = parseDate(annc.annc_deadline_dt);
                
                if (publishDate && deadlineDate) {
                    publishDate.setHours(0, 0, 0, 0);
                    deadlineDate.setHours(0, 0, 0, 0);
                    
                    if (publishDate > today) return 'ê³µê³ ì˜ˆì •';
                    if (deadlineDate < today) return 'ë§ˆê°';
                    return 'ê³µê³ ì¤‘';
                }
            }
            
            return 'ê³µê³ ì¤‘';
        }
        
        // ğŸ”¥ ê³µê³  ì¹´ë“œ ìƒì„± í•¨ìˆ˜ (annc_id ì „ë‹¬ ì¶”ê°€)
        function createAnnouncementCard(annc) {
            let agency = 'LH';
            const title = annc.annc_title || '';
            
            if (annc.annc_url) {
                if (annc.annc_url.includes('i-sh.co.kr')) agency = 'SH';
                else if (annc.annc_url.includes('gh.or.kr') || annc.annc_url.includes('www.gh.or.kr')) agency = 'GH';
                else if (annc.annc_url.includes('lh.or.kr') || annc.annc_url.includes('apply.lh.or.kr')) agency = 'LH';
            }
            
            if (agency === 'LH') {
                if (title.includes('ì„œìš¸') && !title.includes('ê²½ê¸°')) agency = 'SH';
                else if (title.includes('ê²½ê¸°') || title.includes('ìˆ˜ì›') || title.includes('ì„±ë‚¨') || title.includes('ê³ ì–‘') || title.includes('ë¶€ì²œ') || title.includes('ì„¸ì¢…')) agency = 'GH';
            }
            
            let anncType = 'ê³µê³ ';
            if (annc.annc_type) {
                anncType = annc.annc_type;
            } else {
                if (title.includes('ë¶„ì–‘')) anncType = 'ë¶„ì–‘';
                else anncType = 'ì„ëŒ€';
            }
            
            const statusText = getCurrentStatus(annc);
            
            let statusClass = 'status-recruiting';
            let displayStatus = statusText;
            
            if (statusText === 'ì •ì •ê³µê³ ì¤‘') {
                displayStatus = 'ê³µê³ ì¤‘';
            }
            if (statusText === 'ì ‘ìˆ˜ë§ˆê°') {
                displayStatus = 'ë§ˆê°';
            }
            
            if (displayStatus === 'ë§ˆê°') {
                statusClass = 'status-closed';
            } else if (displayStatus === 'ì ‘ìˆ˜ì¤‘') {
                statusClass = 'status-recruiting';
            } else {
                statusClass = 'status-recruiting';
            }
            
            const card = document.createElement('div');
            card.className = 'announcement-card';
            if (statusClass === 'status-closed') {
                card.classList.add('announcement-card-closed');
            }
            card.setAttribute('data-agency', agency);
            card.setAttribute('data-type', anncType);
            card.setAttribute('data-status', statusText);
            
            // ğŸ”¥ annc_id ì¶”ì¶œ (í•„ìˆ˜)
            const announcementId = annc.annc_id || annc.id || '';
            const announcementName = annc.annc_title || 'ê³µê³  ì œëª© ì—†ìŒ';

            card.innerHTML = `
                <div class="announcement-header">
                    <div>
                        <span class="agency-badge agency-${agency.toLowerCase()}">${agency}</span>
                        <span class="type-badge">${anncType}</span>
                    </div>
                    <span class="status-badge ${statusClass}">${displayStatus}</span>
                </div>
                <h3>${announcementName}</h3>
                
                <div class="recruitment-period">
                    <svg class="recruitment-period-icon" viewBox="0 0 20 20" fill="none">
                        <path d="M15.8333 3.33334H4.16667C3.24619 3.33334 2.5 4.07954 2.5 5.00001V16.6667C2.5 17.5872 3.24619 18.3333 4.16667 18.3333H15.8333C16.7538 18.3333 17.5 17.5872 17.5 16.6667V5.00001C17.5 4.07954 16.7538 3.33334 15.8333 3.33334Z" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M13.3333 1.66666V5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.66667 1.66666V5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2.5 8.33334H17.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <div class="recruitment-period-text">
                        <span class="recruitment-period-label">ëª¨ì§‘ ê¸°ê°„</span>
                        <div>
                            <span class="recruitment-period-date">${getRecruitmentPeriod(annc)}</span>
                            <span class="recruitment-period-days">${getDDay(annc)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="announcement-actions">
                    <button class="btn-ai-consult" onclick="goToAIConsult('${announcementId}', '${announcementName.replace(/'/g, "\\'")}')">
                        <svg viewBox="0 0 20 20" fill="none">
                            <path d="M18.3333 14.1667C18.3333 14.6087 18.1577 15.0326 17.8452 15.3452C17.5326 15.6577 17.1087 15.8333 16.6667 15.8333H5.69C5.24801 15.8334 4.82415 16.0091 4.51167 16.3217L2.67667 18.1567C2.59392 18.2394 2.4885 18.2957 2.37374 18.3186C2.25898 18.3414 2.14003 18.3297 2.03192 18.2849C1.92382 18.2401 1.83142 18.1643 1.7664 18.067C1.70139 17.9697 1.66668 17.8553 1.66667 17.7383V4.16667C1.66667 3.72464 1.84226 3.30072 2.15482 2.98816C2.46738 2.67559 2.89131 2.5 3.33333 2.5H16.6667C17.1087 2.5 17.5326 2.67559 17.8452 2.98816C18.1577 3.30072 18.3333 3.72464 18.3333 4.16667V14.1667Z" stroke="white" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        AI ìƒë‹´í•˜ê¸°
                    </button>
                    <button class="btn-website" onclick="window.open('${annc.annc_url || '#'}', '_blank')">
                        <svg viewBox="0 0 20 20" fill="none">
                            <path d="M15 10.8333V15.8333C15 16.2754 14.8244 16.6993 14.5118 17.0118C14.1993 17.3244 13.7754 17.5 13.3333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V6.66667C2.5 6.22464 2.67559 5.80072 2.98816 5.48816C3.30072 5.17559 3.72464 5 4.16667 5H9.16667" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.5 2.5H17.5V7.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8.33333 11.6667L17.5 2.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        ê³µê³ ë¬¸ ì›¹í˜ì´ì§€
                    </button>
                </div>
            `;
            
            return card;
        }

        // ê³µê³  ëª©ë¡ ë¡œë“œ
        async function loadAnnouncements(page = 1) {
            const grid = document.getElementById('announcementGrid');
            grid.innerHTML = '<div style="grid-column: 1 / -1; display: flex; align-items: center; justify-content: center; width: 100%; min-height: 400px; color: #71717b; font-size: 16px;">ë¡œë”© ì¤‘...</div>';
            
            try {
                const searchKeyword = document.getElementById('searchInput')?.value || '';
                const filterStatus = document.getElementById('statusFilter')?.value || '';
                const filterType = document.getElementById('typeFilter')?.value || '';
                const filterRegion = document.getElementById('regionFilter')?.value || '';
                const filterAgency = document.getElementById('agencyFilter')?.value || '';
                
                const params = {
                    current_page: 1,
                    items_per_page: 1000,
                    annc_title: '',
                    annc_status: '',
                    annc_type: '',
                    agency: ''
                };
                
                console.log('[API í˜¸ì¶œ] í•„í„° íŒŒë¼ë¯¸í„° ì—†ì´ ëª¨ë“  ë°ì´í„° ìš”ì²­');
                const response = await API.getAnnouncements(params);
                
                if (response.status === 'success' && response.data) {
                    const pageInfo = response.data.page_info;
                    const items = response.data.items || [];
                    
                    currentPage = pageInfo.current_page || page;
                    totalPages = pageInfo.total_pages || 1;
                    allAnnouncements = items;
                    
                    populateFilterOptions(items);
                    
                    grid.innerHTML = '';
                    
                    if (items.length === 0) {
                        grid.innerHTML = '<div style="grid-column: 1 / -1; display: flex; align-items: center; justify-content: center; width: 100%; min-height: 400px; color: #71717b; font-size: 16px;">ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                        return;
                    }
                    
                    let filteredItems = [...items];
                    
                    console.log(`[í•„í„° ì‹œì‘] ì „ì²´ í•­ëª© ìˆ˜: ${filteredItems.length}, ê²€ìƒ‰ì–´: "${searchKeyword}", ìƒíƒœ: "${filterStatus}", ìœ í˜•: "${filterType}", ì§€ì—­: "${filterRegion}", ê¸°ê´€: "${filterAgency}"`);
                    
                    if (searchKeyword && searchKeyword.trim() !== '') {
                        const keyword = searchKeyword.trim().toLowerCase();
                        filteredItems = filteredItems.filter(annc => {
                            const title = (annc.annc_title || '').toLowerCase();
                            return title.includes(keyword);
                        });
                        console.log(`[ê²€ìƒ‰ í•„í„°] ê²€ìƒ‰ì–´: "${searchKeyword}", í•„í„°ë§ í›„ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                    }
                    
                    if (filterAgency && filterAgency !== '' && filterAgency !== 'ì „ì²´') {
                        console.log(`[í•„í„° ì‹œì‘] ê¸°ê´€ í•„í„°: "${filterAgency}", í•„í„°ë§ ì „ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                        filteredItems = filteredItems.filter(annc => {
                            const url = annc.annc_url || '';
                            let matches = false;
                            if (filterAgency === 'LH') {
                                matches = url.includes('lh.or.kr');
                            } else if (filterAgency === 'SH') {
                                matches = url.includes('i-sh.co.kr');
                            } else if (filterAgency === 'GH') {
                                matches = url.includes('gh.or.kr');
                            }
                            console.log(`[ê¸°ê´€ í•„í„°] ê³µê³ : "${annc.annc_title}", URL: "${url}", í•„í„°: "${filterAgency}", ë§¤ì¹­: ${matches}`);
                            return matches;
                        });
                        console.log(`[í•„í„° ì™„ë£Œ] ê¸°ê´€ í•„í„°ë§ í›„ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                    }
                    
                    if (filterStatus && filterStatus !== '' && filterStatus !== 'ì „ì²´') {
                        console.log(`[í•„í„° ì‹œì‘] ìƒíƒœ í•„í„°: "${filterStatus}", í•„í„°ë§ ì „ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                        filteredItems = filteredItems.filter(annc => {
                            if (filterStatus === 'ì •ì •ê³µê³ ì¤‘') {
                                const matches = annc.annc_title && annc.annc_title.includes('[ì •ì •ê³µê³ ]');
                                console.log(`[ìƒíƒœ í•„í„°] ê³µê³ : "${annc.annc_title}", ì •ì •ê³µê³  í•„í„°, ë§¤ì¹­: ${matches}`);
                                return matches;
                            }
                            
                            const dynamicStatus = getCurrentStatus(annc);
                            const matches = dynamicStatus === filterStatus;
                            console.log(`[ìƒíƒœ í•„í„°] ê³µê³ : "${annc.annc_title}", ì›ë³¸ ìƒíƒœ: "${annc.annc_status}", ë™ì  ìƒíƒœ: "${dynamicStatus}", í•„í„°: "${filterStatus}", ë§¤ì¹­: ${matches}`);
                            return matches;
                        });
                        console.log(`[í•„í„° ì™„ë£Œ] ìƒíƒœ í•„í„°ë§ í›„ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                    }
                    
                    if (filterType && filterType !== '' && filterType !== 'ì „ì²´') {
                        console.log(`[í•„í„° ì‹œì‘] ìœ í˜• í•„í„°: "${filterType}", í•„í„°ë§ ì „ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                        filteredItems = filteredItems.filter(annc => {
                            const matches = annc.annc_type === filterType;
                            console.log(`[ìœ í˜• í•„í„°] ê³µê³ : "${annc.annc_title}", annc_type: "${annc.annc_type}", í•„í„°: "${filterType}", ë§¤ì¹­: ${matches}`);
                            return matches;
                        });
                        console.log(`[í•„í„° ì™„ë£Œ] ìœ í˜• í•„í„°ë§ í›„ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                    }
                    
                    if (filterRegion && filterRegion !== '' && filterRegion !== 'ì „ì²´') {
                        console.log(`[í•„í„° ì‹œì‘] ì§€ì—­ í•„í„°: "${filterRegion}", í•„í„°ë§ ì „ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                        filteredItems = filteredItems.filter(annc => {
                            const matches = annc.annc_region === filterRegion;
                            console.log(`[ì§€ì—­ í•„í„°] ê³µê³ : "${annc.annc_title}", annc_region: "${annc.annc_region}", í•„í„°: "${filterRegion}", ë§¤ì¹­: ${matches}`);
                            return matches;
                        });
                        console.log(`[í•„í„° ì™„ë£Œ] ì§€ì—­ í•„í„°ë§ í›„ í•­ëª© ìˆ˜: ${filteredItems.length}`);
                    }
                    
                    if (filteredItems.length === 0) {
                        grid.innerHTML = '<div style="grid-column: 1 / -1; display: flex; align-items: center; justify-content: center; width: 100%; min-height: 400px; color: #71717b; font-size: 16px;">ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                        totalPages = 1;
                        currentPage = 1;
                        renderPagination();
                        return;
                    }
                    
                    const sortedItems = filteredItems.sort((a, b) => {
                        const statusPriority = {
                            'ê³µê³ ì¤‘': 1,
                            'ì ‘ìˆ˜ì¤‘': 2,
                            'ì •ì •ê³µê³ ì¤‘': 1,
                            'ê³µê³ ì˜ˆì •': 3,
                            'ë§ˆê°': 4,
                            'ì ‘ìˆ˜ë§ˆê°': 4
                        };
                        
                        const statusA = getCurrentStatus(a);
                        const statusB = getCurrentStatus(b);
                        
                        const priorityA = statusPriority[statusA] || 5;
                        const priorityB = statusPriority[statusB] || 5;
                        
                        if (priorityA !== priorityB) {
                            return priorityA - priorityB;
                        }
                        
                        const dateA = a.created_at ? new Date(a.created_at) : new Date(0);
                        const dateB = b.created_at ? new Date(b.created_at) : new Date(0);
                        return dateB - dateA;
                    });
                    
                    const itemsPerPage = 10;
                    const startIndex = (page - 1) * itemsPerPage;
                    const endIndex = startIndex + itemsPerPage;
                    const paginatedItems = sortedItems.slice(startIndex, endIndex);
                    
                    console.log(`[í˜ì´ì§€ë„¤ì´ì…˜] í˜ì´ì§€: ${page}, ì „ì²´ í•­ëª©: ${sortedItems.length}, í‘œì‹œ í•­ëª©: ${paginatedItems.length} (${startIndex}~${endIndex})`);
                    
                    paginatedItems.forEach(annc => {
                        const card = createAnnouncementCard(annc);
                        grid.appendChild(card);
                    });
                    
                    totalPages = Math.ceil(sortedItems.length / itemsPerPage);
                    currentPage = page;
                    renderPagination();
                } else {
                    grid.innerHTML = '<div style="grid-column: 1 / -1; display: flex; align-items: center; justify-content: center; width: 100%; min-height: 400px; color: #dc2626; font-size: 16px;">ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ê³µê³  ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìƒì„¸:', error.message, error.stack);
                grid.innerHTML = '<div style="grid-column: 1 / -1; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; min-height: 400px; color: #dc2626; font-size: 16px;">ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br><small style="color: #71717b; margin-top: 8px; font-size: 14px;">' + (error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') + '</small></div>';
            }
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
        function renderPagination() {
            const container = document.getElementById('paginationContainer');
            
            if (totalPages <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';
            container.innerHTML = '';
            
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = 'ì´ì „';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    loadAnnouncements(currentPage - 1);
                }
            };
            container.appendChild(prevBtn);
            
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-btn';
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.onclick = () => loadAnnouncements(i);
                container.appendChild(pageBtn);
            }
            
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = 'ë‹¤ìŒ';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    loadAnnouncements(currentPage + 1);
                }
            };
            container.appendChild(nextBtn);
        }

        // í•„í„°ë§ í•¨ìˆ˜
        function filterAnnouncements() {
            loadAnnouncements(1);
        }
        
        // ê²€ìƒ‰ ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
        let searchTimeout;
        function debounceSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                filterAnnouncements();
            }, 300);
        }

        // ì±„íŒ… ì„¸ì…˜ ë¡œë“œ (íˆìŠ¤í† ë¦¬ í´ë¦­ ì‹œ)
        window.loadChatSession = function(sessionId) {
            window.location.href = `{% url "web:chat" %}?session_id=${sessionId}`;
        };

        // ì±„íŒ… ì„¸ì…˜ ì‚­ì œ
        window.deleteChatSession = async function(event, sessionId) {
            // ì´ë²¤íŠ¸ ì „íŒŒ ì¤‘ì§€ (ë¶€ëª¨ ìš”ì†Œ í´ë¦­ ë°©ì§€)
            event.stopPropagation();

            // ì‚­ì œ í™•ì¸
            if (!confirm('ì´ ì±„íŒ… ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const userKey = getOrCreateUserKey();

                // API í˜¸ì¶œ
                const response = await API.deleteChatHistory(sessionId, userKey);

                if (response && response.status === 'success') {
                    // íˆìŠ¤í† ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    await loadChatHistories();
                } else {
                    alert('ì±„íŒ… ê¸°ë¡ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì±„íŒ… ê¸°ë¡ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì±„íŒ… ê¸°ë¡ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };

        // ì±„íŒ… íˆìŠ¤í† ë¦¬ ë¡œë“œ
        async function loadChatHistories() {
            const chatHistoryList = document.getElementById('chatHistoryList');

            try {
                const userKey = getOrCreateUserKey();
                const response = await API.getChatHistories(userKey);

                if (response.status === 'success' && response.data && Array.isArray(response.data)) {
                    chatHistoryList.innerHTML = '';

                    response.data.forEach(history => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'chat-history-item';

                        historyItem.innerHTML = `
                            <div class="chat-history-content" onclick="loadChatSession('${history.session_id}')">
                                <h5>${history.title}</h5>
                                <p>ìµœê·¼ ëŒ€í™”...</p>
                            </div>
                            <button class="chat-delete-btn" onclick="deleteChatSession(event, '${history.session_id}')" title="ì‚­ì œ">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        `;
                        chatHistoryList.appendChild(historyItem);
                    });
                }
            } catch (error) {
                console.error('ì±„íŒ… íˆìŠ¤í† ë¦¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.addEventListener('load', async function() {
            if (typeof API === 'undefined') {
                console.warn('API ê°ì²´ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.');
                setTimeout(async () => {
                    if (typeof API !== 'undefined') {
                        loadUserInfo();
                        await loadChatHistories();
                        await loadAnnouncements(1);
                    } else {
                        console.error('API ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. mockData.jsê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
                    }
                }, 100);
            } else {
                loadUserInfo();
                await loadChatHistories();
                await loadAnnouncements(1);
            }
        });
        
        // ì‚¬ì´ë“œë°” í† ê¸€ (ëª¨ë°”ì¼)
        window.toggleSidebar = function(e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            console.log('toggleSidebar called', { sidebar, overlay });
            
            if (sidebar) {
                const isActive = sidebar.classList.contains('show') || sidebar.classList.contains('active');
                
                if (isActive) {
                    sidebar.classList.remove('show');
                    sidebar.classList.remove('active');
                    if (overlay) {
                        overlay.classList.remove('show');
                        overlay.classList.remove('active');
                    }
                } else {
                    sidebar.classList.add('show');
                    sidebar.classList.add('active');
                    if (overlay) {
                        overlay.classList.add('show');
                        overlay.classList.add('active');
                    }
                }
            }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.querySelector('.mobile-menu-toggle');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    window.toggleSidebar(e);
                });
                toggleBtn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    window.toggleSidebar(e);
                });
            }
        });
    </script>
</body>
</html>
