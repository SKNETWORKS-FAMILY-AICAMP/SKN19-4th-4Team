## 1. 요구사항

### 1.1 기능적 요구사항

#### 1.1.1 화면 이동 및 공통 기능

| 기능 ID | 기능명 | 우선순위 | 상세설명 (검증 기준 포함) |
|---------|--------|----------|---------------------------|
| FUNC-NAV-001 | 메뉴를 통한 페이지 이동 | 높음 | **기능:** 왼쪽 메뉴에서 홈, AI 상담, 공고 목록 페이지를 클릭하면 해당 페이지로 이동한다.<br>**구현:** 모든 HTML 템플릿의 사이드바 메뉴에 Django URL 링크를 연결하여 페이지 이동.<br>**검증:** 홈, AI 상담, 공고 목록 메뉴를 각각 클릭했을 때 올바른 페이지로 이동하는지 확인. 현재 있는 페이지는 메뉴에 색으로 강조 표시. |
| FUNC-NAV-002 | 이전 대화 목록 보기 | 중간 | **기능:** 왼쪽 메뉴에서 이전에 했던 대화 목록을 최신 순서로 확인할 수 있다. 각 대화의 제목은 첫 번째 질문으로 자동 설정된다.<br>**구현:** `main.js`의 `loadChatHistories` 함수가 서버에서 대화 목록을 가져와 사이드바에 표시.<br>**검증:** 새로운 대화를 시작하면 왼쪽 메뉴에 해당 대화가 추가되는지 확인. 대화 제목이 첫 번째 질문으로 표시되는지 확인. |
| FUNC-NAV-003 | 이전 대화 불러오기 | 중간 | **기능:** 왼쪽 메뉴의 대화 목록에서 특정 대화를 클릭하면 그 대화의 전체 내용을 다시 볼 수 있다.<br>**구현:** `chat.html`의 `loadChatSession` 함수가 세션 ID를 URL로 전달하여 페이지 이동하고, `loadChatHistory` 함수가 서버에서 대화 내용을 가져와 표시.<br>**검증:** 대화 목록에서 이전 대화를 클릭하면 사용자 질문과 AI 답변이 순서대로 표시되는지 확인. |
| FUNC-NAV-004 | 대화 기록 삭제 | 낮음 | **기능:** 대화 목록에서 삭제 버튼을 클릭하면 해당 대화를 완전히 삭제할 수 있다. 삭제 전에 확인 메시지가 표시된다.<br>**구현:** `chat.html`의 `deleteChatSession` 함수가 확인 대화상자를 표시한 후 서버에 삭제 요청을 보내고, DB에서 대화 기록 삭제.<br>**검증:** 삭제 버튼 클릭 시 "정말 삭제하시겠습니까?" 확인 메시지 표시. 확인 후 대화가 목록에서 사라지고 DB에서도 삭제되었는지 확인. 현재 보고 있는 대화를 삭제하면 메인 페이지로 이동. |
| FUNC-NAV-005 | 메인 화면 통계 정보 | 낮음 | **기능:** 메인 페이지에서 전체 공고 수, 이번 주 신규 공고, 누적 상담 수, 활성 사용자 수를 한눈에 볼 수 있다.<br>**구현:** `main.html`의 대시보드 카드 영역에 통계 정보를 표시 (현재 누적 상담 및 활성 사용자는 고정값 표시).<br>**검증:** 메인 페이지 접속 시 4개의 통계 카드(전체 공고, 이번 주 신규, 누적 상담, 활성 사용자)가 표시되는지 확인. |

#### 1.1.2 AI 상담 (챗봇)

| 기능 ID | 기능명 | 우선순위 | 상세설명 (검증 기준 포함) |
|---------|--------|----------|---------------------------|
| FUNC-AI-001 | 의도 분류 기반 대화 처리 | 높음 | **기능:** LangGraph 기반 AI 챗봇이 사용자 질의를 5가지 의도로 분류(검색/선택/상세/비교/일반대화)하여 처리한다.<br>**구현:** `graph.py`의 `classify_intent` 노드에서 OpenAI API를 통해 의도를 분류하고, 라우팅 노드에서 적절한 노드로 분기한다.<br>**검증:** 각 의도별 테스트 질의(예: "청년 공고 알려줘", "1번 선택", "신청자격은?", "1번이랑 2번 비교", "안녕")에 대해 정확한 의도 분류율 90% 이상 |
| FUNC-AI-002 | RDB 필터 + RAG 기반 공고 검색 | 높음 | **기능:** 사용자 질의를 분석하여 RDB 필터(상태, 유형, 지역)와 RAG 검색을 결합하여 관련 공고를 검색한다. 쿼리 확장(동의어)을 통해 검색 정확도를 향상시킨다.<br>**구현:** `services.py`의 `search_announcements_rdb_with_rag` 함수가 RDB 필터링 후 RAG 재순위 적용. 동의어 딕셔너리를 활용하여 검색어 확장.<br>**검증:** "신혼부부 공고" 검색 시 신혼부부 관련 공고가 상위 3개 이내 포함, RDB 필터(예: "서울 분양 공고")가 정확히 적용됨 |
| FUNC-AI-003 | 공고 선택 및 상세 정보 제공 | 높음 | **기능:** 검색된 공고 목록에서 번호 또는 공고명으로 특정 공고를 선택하면 해당 공고의 상세 정보(신청자격, 면적, 임대료, 기간, 구비서류 등)를 RAG 기반으로 제공한다.<br>**구현:** `graph.py`의 `select_announcement` 노드에서 선택된 공고 정보를 세션에 저장하고, `respond_to_general_question` 노드에서 RAG 검색 시 선택된 공고 문서만 필터링하여 답변 생성.<br>**검증:** 선택한 공고의 상세 질문(예: "신청자격은?")에 대해 해당 공고 문서 기반 답변 제공, 다른 공고 정보 포함 안 됨 |
| FUNC-AI-004 | 다중 공고 비교 기능 | 중간 | **기능:** 2개 이상의 공고를 선택하여 주요 항목(지역, 대상자, 자격, 면적, 임대조건, 일정)을 표 형식으로 비교 분석한다.<br>**구현:** `graph.py`의 `compare_announcements` 노드에서 최근 검색 결과 중 여러 공고를 선택하고, RAG 검색으로 각 공고의 비교 항목 정보를 추출하여 마크다운 표로 생성.<br>**검증:** "1번이랑 2번 비교" 입력 시 두 공고의 비교표 형식 응답 출력, 표에 지역/대상자/자격/면적/임대조건/일정 항목 포함 |
| FUNC-AI-005 | 사용자 프로필 기반 맞춤 추천 | 중간 | **기능:** 사용자가 입력한 프로필 정보(나이, 희망지역, 혼인여부, 자녀수, 소득)를 참고하여 맞춤형 공고 추천 및 분석을 제공한다.<br>**구현:** `views_chat.py`의 `chat_message` API가 요청 파라미터로 사용자 프로필 수신, 이를 그래프 설정에 포함시켜 검색 및 답변 생성 시 프롬프트에 삽입.<br>**검증:** 사용자 프로필(예: 나이 30세, 희망지역 서울, 혼인Y, 자녀 1명, 소득 5000만원) 입력 후 "추천해줘" 입력 시 프로필 조건에 맞는 공고 추천 및 근거 언급 |
| FUNC-AI-006 | 채팅 히스토리 관리 | 높음 | **기능:** 세션별 대화 내역을 DB에 저장하고, 이전 대화 기록을 불러올 수 있다. 최대 10턴의 대화 히스토리를 유지한다.<br>**구현:** `models.py`의 `ChatHistory` 모델에 세션별 메시지 저장. `views_chat.py`에서 최근 10턴 조회하여 그래프 상태에 삽입. `views.py`의 `get_chat_history_detail` API로 전체 히스토리 조회.<br>**검증:** 세션 ID로 이전 대화 복원 시 전체 메시지 순서대로 표시, 10턴 이상 대화 시 최근 10턴만 컨텍스트로 활용 |
| FUNC-AI-007 | 마크다운 렌더링 응답 | 낮음 | **기능:** AI 응답을 마크다운 형식으로 렌더링하여 가독성을 높인다(표, 리스트, 강조 등).<br>**구현:** 프론트엔드 `chat.html`에서 Marked.js 라이브러리를 사용하여 AI 응답 텍스트를 HTML로 변환하여 표시.<br>**검증:** 표 형식 응답이 HTML 테이블로 정상 렌더링, 리스트(-, *)가 ul/li로 변환, **강조**가 `<strong>` 태그로 표시 |
| FUNC-AI-008 | 로딩 상태 표시 | 낮음 | **기능:** AI 응답 생성 중 로딩 애니메이션과 진행 메시지를 표시한다.<br>**구현:** `chat.html`의 `addLoadingMessage` 함수가 로딩 닷 애니메이션과 "답변을 생성하고 있습니다..." 메시지를 표시하고, API 응답 완료 시 `removeLoadingMessage`로 제거.<br>**검증:** 질의 전송 후 응답 완료 전까지 로딩 표시 확인, 로딩 애니메이션 동작 확인 |
| FUNC-AI-009 | 웹 검색 연동 | 낮음 | **기능:** 최신 정보가 필요한 질의에 대해 Tavily 웹 검색 결과를 참고하여 답변한다.<br>**구현:** `graph.py`의 `respond_to_general_question` 노드에서 Tavily API를 호출하여 웹 검색 수행. 검색 결과를 프롬프트에 포함하여 답변 생성.<br>**검증:** "2025년 청약 정책" 질의 시 웹 검색 결과 포함 여부 확인, 답변에 최신 정보 반영 확인 |

#### 1.1.3 공고 관리

| 기능 ID | 기능명 | 우선순위 | 상세설명 (검증 기준 포함) |
|---------|--------|----------|---------------------------|
| FUNC-ANN-001 | 공고 목록 조회 | 높음 | **기능:** 등록된 공공주택 공고 목록을 페이지네이션(한 페이지당 최대 10개)으로 조회한다. 공고 상태별 우선순위 정렬(공고중 > 접수중 > 마감) 및 최신순 정렬을 적용한다.<br>**구현:** `views.py`의 `get_announcements` API가 DB 조회 후 페이지네이션 적용. 프론트엔드 `list.html`에서 상태 우선순위와 생성일 기준 정렬.<br>**검증:** 공고 목록 페이지 접속 시 10개 항목 표시, 페이지 번호 클릭 시 다음 10개 표시, 공고중 공고가 마감 공고보다 상위에 표시 |
| FUNC-ANN-002 | 다중 필터 검색 | 높음 | **기능:** 키워드(공고 제목), 공고 유형(분양/임대), 지역(광역시/도), 공고 상태(공고중/접수중/마감/정정공고중)로 공고를 필터링한다. 검색 결과 없음 시 '공고가 없습니다' 메시지를 표시한다.<br>**구현:** `list.html`의 필터 컨트롤(검색창, 유형/지역/상태 선택박스)에서 입력값 수집 후 `filterAnnouncements` 함수가 클라이언트 사이드에서 필터링 수행.<br>**검증:** 각 필터 조합(예: 키워드 "청년" + 유형 "임대" + 지역 "서울" + 상태 "공고중") 선택 시 조건에 맞는 공고만 표시 |
| FUNC-ANN-003 | 공고 카드 정보 표시 | 중간 | **기능:** 공고 카드에 기관(LH/SH/GH), 유형(분양/임대), 상태, 제목, 모집기간, D-Day를 표시한다.<br>**구현:** `list.html`의 `createAnnouncementCard` 함수가 공고 데이터를 기반으로 카드 HTML 생성. `getRecruitmentPeriod`와 `getDDay` 함수로 기간 및 D-Day 계산.<br>**검증:** 모든 공고 카드에 기관 배지, 유형 배지, 상태 배지, 제목, 모집기간, D-Day 표시 확인, D-Day 계산 정확도(마감일 기준) 확인 |
| FUNC-ANN-004 | 공고별 AI 상담 연동 | 높음 | **기능:** 공고 카드의 "AI 상담하기" 버튼 클릭 시 해당 공고 컨텍스트를 유지한 채 채팅 페이지로 이동한다. announcement_id를 URL 파라미터로 전달하여 AI가 해당 공고 문서를 우선 참조한다.<br>**구현:** `list.html`의 `goToAIConsult` 함수가 공고 ID와 이름을 sessionStorage에 저장하고 URL 파라미터로 전달. `chat.html`에서 파라미터 확인 후 AI 요청 시 포함.<br>**검증:** "AI 상담하기" 클릭 후 채팅에서 "이 공고 요약해줘" 입력 시 해당 공고 정보만 제공, 다른 공고 정보 포함 안 됨 |
| FUNC-ANN-005 | 공고문 원문 링크 | 중간 | **기능:** 공고 카드의 "공고문 웹페이지" 버튼 클릭 시 공식 공고 URL을 새 창에서 연다.<br>**구현:** `list.html`의 버튼 `onclick` 이벤트에서 `window.open(annc_url, '_blank')` 호출.<br>**검증:** 버튼 클릭 시 정확한 공고 URL 새 창 열림, LH/SH/GH 공식 페이지로 이동 확인 |
| FUNC-ANN-006 | 실시간 상태 업데이트 | 중간 | **기능:** 공고 게시일과 마감일 기준으로 현재 상태(공고중/마감)를 동적으로 계산하여 표시한다.<br>**구현:** `list.html`의 `getCurrentStatus` 함수가 오늘 날짜와 게시일/마감일 비교하여 상태 계산.<br>**검증:** 마감일 지난 공고는 '마감' 상태로 표시 |

#### 1.1.4 사용자 관리

| 기능 ID | 기능명 | 우선순위 | 상세설명 (검증 기준 포함) |
|---------|--------|----------|---------------------------|
| FUNC-USR-001 | 익명 사용자 ID 자동 생성 | 높음 | **기능:** 최초 접속 시 UUID 기반 고유 사용자 ID를 자동 생성하고 LocalStorage에 저장한다.<br>**구현:** `main.js`의 `getOrCreateUserKey` 함수가 LocalStorage에서 user_key 조회, 없으면 UUID 생성 후 저장.<br>**검증:** 최초 접속 시 user_key 자동 생성 및 저장 확인(개발자 도구 > Application > LocalStorage), 재접속 시 동일 ID 유지 |
| FUNC-USR-002 | 사용자 프로필 입력 및 수정 | 중간 | **기능:** 만 나이, 희망 거주지, 혼인 상태(Y/N), 자녀 수, 연소득을 입력/수정할 수 있다. 입력된 정보는 LocalStorage에 저장되며, AI 상담 시 참고 정보로 활용된다.<br>**구현:** `user_info_modify.html`에서 사용자 정보 입력 폼 제공, 저장 시 LocalStorage의 userInfo 객체로 저장. `chat.html`의 `convertUserInfoToAPIFormat` 함수가 AI API 요청 시 프로필 정보를 포함.<br>**검증:** 사용자 정보 입력 후 LocalStorage에 userInfo 객체 저장 확인, AI 상담 시 API 요청 파라미터에 ref_hope_area, ref_age, ref_marriged, ref_children, ref_income 포함 확인 |
| FUNC-USR-003 | 사용자 정보 초기화 | 낮음 | **기능:** 사용자 정보 수정 페이지에서 "초기화" 버튼 클릭 시 사용자 정보 및 채팅 히스토리를 완전 삭제하고 랜딩 페이지로 이동한다.<br>**구현:** `user_info_modify.html`의 초기화 버튼 클릭 시 LocalStorage 및 sessionStorage의 userInfo, user_key 삭제 후 메인 페이지로 리다이렉트.<br>**검증:** 초기화 후 LocalStorage 및 sessionStorage에서 사용자 정보 삭제 확인, 메인 페이지로 이동 확인 |

### 1.2 비기능적 요구사항

| 요구사항 ID | 분류 | 요구사항 내용 | 검증 기준 |
|-------------|------|---------------|-----------|
| NFUNC-PERF-001 | 성능 | AI 응답 생성 시간은 평균 7초 이내여야 한다 | OpenAI API 호출 포함 응답 시간 측정 (10회 평균) |
| NFUNC-PERF-002 | 성능 | 공고 목록 페이지 초기 로딩은 2초 이내여야 한다 | 10개 공고 로딩 시간 측정 (Network 탭) |
| NFUNC-PERF-003 | 성능 | RAG 검색은 1,000개 이상의 청크에서 Top-K(15개) 검색을 1초 이내 완료해야 한다 | 벡터 검색 응답 시간 측정 (서버 로그) |
| NFUNC-USAB-001 | 사용성 | 모바일(375px~), 태블릿(768px~), 데스크톱(1024px~) 해상도를 지원해야 한다 | 각 해상도별 UI 정상 표시 확인 (Chrome DevTools) |
| NFUNC-USAB-002 | 사용성 | 마크다운 렌더링 시 표, 리스트, 링크가 정상 표시되어야 한다 | Marked.js 렌더링 결과 확인 (표/리스트/링크 포함 응답) |
| NFUNC-USAB-003 | 사용성 | 로딩 상태를 명확히 표시하여 사용자가 대기 시간을 인지할 수 있어야 한다 | 로딩 애니메이션 및 메시지 표시 확인 |
| NFUNC-SEC-001 | 보안 | Django CSRF 토큰을 활용하여 CSRF 공격을 방지해야 한다 | POST 요청 시 CSRF 토큰 검증 확인 |
| NFUNC-SEC-002 | 보안 | API 키(OpenAI, Tavily)는 환경 변수로 관리하여 코드에 노출되지 않아야 한다 | .env 파일 사용 확인, 코드에 하드코딩 없음 확인 |
| NFUNC-RELI-001 | 안정성 | 채팅 세션은 DB에 영구 저장되어야 하며, 브라우저 종료 후에도 복원 가능해야 한다 | 브라우저 재시작 후 세션 복원 확인 (DB 저장 확인) |


## 2. 제약사항

### 2.1 기술적 제약사항

- **데이터 범위**: 프로토타입은 LH 공고만 대상 (지역 한정)
- **LLM API 비용**: OpenAI API 사용으로 인한 비용 발생
- **세션 저장**: 데이터베이스에 저장하여 영구 보존
- **공고 업데이트**: 수동 크롤링으로 실시간 업데이트 어려움

### 2.2 비즈니스 제약사항

- **익명 사용자**: 회원 가입 없이 사용 가능
- **무료 서비스**: 현재는 무료로 제공

## 3. 향후 확장 계획

### Phase 2
- 자격 진단 기능 구현
- GH/SH 공고 통합
- 공고 목록 완성

### Phase 3
- 대출 정보 제공 기능
- 계약 지원 기능
- 알림 기능

## 4. 참고 자료

- [프로젝트 산출물](./00_프로젝트_산출물.md)
- [시스템 구성도](./04_시스템_구성도.md)
- [개발된 LLM 연동 웹 애플리케이션](./03_개발된_LLM_연동_웹_애플리케이션.md)
- [화면설계서](./02_화면설계서.md)


